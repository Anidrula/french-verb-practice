<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>French Conjugation Practice - Savoir</title>
<style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: #d9ecff;
        margin: 0;
        padding: 20px;
        display: flex;
        justify-content: center;
        color: #154a7e;
    }
    .conj-block {
        background: #f0f7ff;
        padding: 30px 40px;
        border-radius: 12px;
        max-width: 800px;
        width: 100%;
        box-sizing: border-box;
        box-shadow: 0 5px 15px rgba(21, 74, 126, 0.2);
    }
    h2, h3 {
        margin-bottom: 24px;
    }
    table {
        border-collapse: collapse;
        width: 100%;
        background: #e6f0ff;
        border-radius: 8px;
        overflow: hidden;
    }
    th, td {
        border: 1px solid #b5d1ff;
        padding: 14px 16px;
        text-align: center;
        font-size: 1.2rem;
    }
    input[type="text"] {
        padding: 12px;
        font-size: 1.2rem;
        border-radius: 8px;
        border: 1px solid #7fb1ff;
        width: 140px;
        box-sizing: border-box;
        transition: border-color 0.2s ease;
    }
    input[type="text"]:focus {
        outline: none;
        border-color: #3a7bd5;
        box-shadow: 0 0 6px #3a7bd5aa;
    }
    .btn {
        padding: 10px 28px;
        margin: 14px 14px 0 0;
        font-size: 1.1rem;
        border-radius: 10px;
        border: 1px solid #3a7bd5;
        background-color: #6799ff;
        color: white;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.25s ease;
    }
    .btn:hover {
        background-color: #3a7bd5;
    }
    .score {
        margin-top: 20px;
        font-weight: 600;
        font-size: 1.25rem;
        color: #123a6d;
    }
    .prev-block {
        background: #d3e2ff;
        padding: 18px 25px;
        margin: 30px 0 0 0;
        border-radius: 12px;
        box-sizing: border-box;
        max-height: 250px;
        overflow-y: auto;
    }
    .prev-block h4 {
        margin-top: 0;
        color: #0f2d66;
    }
    .correct {
        background-color: #addfad;
        border: 1px solid #469436;
        color: #1a3e12;
    }
    .incorrect {
        background-color: #f8b1ae;
        border: 1px solid #d5453d;
        color: #7b1d19;
    }
    /* Responsive */
    @media only screen and (max-width: 600px) {
        body {
            padding: 12px;
        }
        .conj-block {
            padding: 24px 18px;
            max-width: 100%;
        }
        th, td {
            font-size: 1rem;
            padding: 10px 8px;
        }
        input[type="text"] {
            width: 100%;
            font-size: 1.1rem;
            padding: 14px;
        }
        .btn {
            width: 100%;
            margin: 12px 0 0 0;
        }
        .btn + .btn {
            margin-left: 0;
        }
        .prev-block {
            max-height: 180px;
            padding: 14px 16px;
        }
        .toggle-group label {
            font-size: 1.1rem;
        }
    }
    .toggle-group {
        background: #eef6ff;
        border-radius: 10px;
        padding: 10px 16px 18px 16px;
        margin-bottom: 20px;
        box-sizing: border-box;
    }
    .toggle-group label {
        margin-right: 24px;
        font-weight: 600;
        cursor: pointer;
    }
    .toggle-group input[type="checkbox"] {
        margin-right: 8px;
    }
</style>
</head>
<body>
<div class="conj-block" role="main" aria-label="French Verb Conjugation Practice">
    <h2>Pratiquer la conjugaison des verbes <span style="color:#3a7bd5; font-weight:700;">[translate:savoir]</span> et <span style="color:#3a7bd5; font-weight:700;">[translate:se savoir]</span></h2>
    <div class="toggle-group" aria-label="Options">
        <label><input type="checkbox" id="toggleTenses" checked /> Tenses aléatoires activés</label>
        <label><input type="checkbox" id="togglePronominal" checked /> Formes pronominales activées</label>
    </div>
    <div id="description"></div>
    <form id="practiceForm" autocomplete="off" aria-labelledby="description">
        <table>
            <thead>
            <tr>
                <th scope="col">Sujet</th>
                <th scope="col">[translate:savoir]</th>
                <th scope="col" id="pronominal-header">[translate:se savoir]</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td id="lbl-je">[translate:je]</td>
                <td><input type="text" id="savoir-je" name="savoir-je" aria-labelledby="lbl-je" autocomplete="off"/></td>
                <td class="pronominal-col"><input type="text" id="sesavoir-je" name="sesavoir-je" aria-labelledby="lbl-je" autocomplete="off"/></td>
            </tr>
            <tr>
                <td id="lbl-tu">[translate:tu]</td>
                <td><input type="text" id="savoir-tu" name="savoir-tu" aria-labelledby="lbl-tu" autocomplete="off"/></td>
                <td class="pronominal-col"><input type="text" id="sesavoir-tu" name="sesavoir-tu" aria-labelledby="lbl-tu" autocomplete="off"/></td>
            </tr>
            <tr>
                <td id="lbl-il">[translate:il/elle/on]</td>
                <td><input type="text" id="savoir-il" name="savoir-il" aria-labelledby="lbl-il" autocomplete="off"/></td>
                <td class="pronominal-col"><input type="text" id="sesavoir-il" name="sesavoir-il" aria-labelledby="lbl-il" autocomplete="off"/></td>
            </tr>
            <tr>
                <td id="lbl-nous">[translate:nous]</td>
                <td><input type="text" id="savoir-nous" name="savoir-nous" aria-labelledby="lbl-nous" autocomplete="off"/></td>
                <td class="pronominal-col"><input type="text" id="sesavoir-nous" name="sesavoir-nous" aria-labelledby="lbl-nous" autocomplete="off"/></td>
            </tr>
            <tr>
                <td id="lbl-vous">[translate:vous]</td>
                <td><input type="text" id="savoir-vous" name="savoir-vous" aria-labelledby="lbl-vous" autocomplete="off"/></td>
                <td class="pronominal-col"><input type="text" id="sesavoir-vous" name="sesavoir-vous" aria-labelledby="lbl-vous" autocomplete="off"/></td>
            </tr>
            <tr>
                <td id="lbl-ils">[translate:ils/elles]</td>
                <td><input type="text" id="savoir-ils" name="savoir-ils" aria-labelledby="lbl-ils" autocomplete="off"/></td>
                <td class="pronominal-col"><input type="text" id="sesavoir-ils" name="sesavoir-ils" aria-labelledby="lbl-ils" autocomplete="off"/></td>
            </tr>
            </tbody>
        </table>

        <button class="btn" type="button" onclick="checkAnswers()">Vérifier les réponses</button>
        <button class="btn" type="button" onclick="nextRound()">Tour suivant</button>
        <button class="btn" type="button" onclick="resetForm()">Réinitialiser</button>
    </form>

    <div class="score" id="scoreBlock" aria-live="polite"></div>

    <div class="prev-block" id="prevAnswersBlock" style="display:none;">
        <h4>Essais précédents</h4>
        <ul id="prevAnswersList" aria-live="polite"></ul>
    </div>
</div>

<script>
    const conjugationDb = {
        'Présent': {
            'je': ['sais', 'me sais'],
            'tu': ['sais', 'te sais'],
            'il': ['sait', 'se sait'],
            'nous': ['savons', 'nous savons'],
            'vous': ['savez', 'vous savez'],
            'ils': ['savent', 'se savent']
        },
        'Imparfait': {
            'je': ['savais', 'me savais'],
            'tu': ['savais', 'te savais'],
            'il': ['savait', 'se savait'],
            'nous': ['savions', 'nous savions'],
            'vous': ['saviez', 'vous saviez'],
            'ils': ['savaient', 'se savaient']
        },
        'Futur simple': {
            'je': ['saurai', 'me saurai'],
            'tu': ['sauras', 'te sauras'],
            'il': ['saura', 'se saura'],
            'nous': ['saurons', 'nous saurons'],
            'vous': ['saurez', 'vous saurez'],
            'ils': ['sauront', 'se sauront']
        },
        'Passé composé': {
            'je': ['ai su', 'me suis su'],
            'tu': ['as su', 't\'es su'],
            'il': ['a su', 's\'est su'],
            'nous': ['avons su', 'nous sommes sus'],
            'vous': ['avez su', 'vous êtes sus'],
            'ils': ['ont su', 'se sont sus']
        },
        'Plus-que-parfait': {
            'je': ['avais su', 'm\'étais su'],
            'tu': ['avais su', 't\'étais su'],
            'il': ['avait su', 's\'était su'],
            'nous': ['avions su', 'nous étions sus'],
            'vous': ['aviez su', 'vous étiez sus'],
            'ils': ['avaient su', 's\'étaient sus']
        },
        'Conditionnel': {
            'je': ['saurais', 'me saurais'],
            'tu': ['saurais', 'te saurais'],
            'il': ['saurait', 'se saurait'],
            'nous': ['saurions', 'nous saurions'],
            'vous': ['sauriez', 'vous sauriez'],
            'ils': ['sauraient', 'se sauraient']
        }
    };

    const tenses = Object.keys(conjugationDb);
    const subjects = ['je', 'tu', 'il', 'nous', 'vous', 'ils'];

    let currentTense = tenses[0];
    let useRandomTense = true;
    let usePronominal = true;
    let prevAnswers = [];

    // DOM references for toggles
    const toggleTenses = document.getElementById('toggleTenses');
    const togglePronominal = document.getElementById('togglePronominal');
    const pronominalHeaders = document.querySelectorAll('.pronominal-col, #pronominal-header');

    // Setup toggle event listeners
    toggleTenses.addEventListener('change', () => {
        useRandomTense = toggleTenses.checked;
        if (!useRandomTense) {
            // If fixed tense, reset to Présent
            currentTense = 'Présent';
        }
        updateDescription();
        resetForm();
        clearScore();
    });

    togglePronominal.addEventListener('change', () => {
        usePronominal = togglePronominal.checked;
        pronominalHeaders.forEach(el => {
            el.style.display = usePronominal ? '' : 'none';
        });
        resetForm();
        clearScore();
    });

    function updateDescription() {
        document.getElementById('description').innerHTML =
            `<h3>Conjuguez <span style="color:#3a7bd5; font-weight:bold;">[translate:savoir]</span>` +
            `${usePronominal ? ` et <span style="color:#3a7bd5; font-weight:bold;">[translate:se savoir]</span>` : ''}` +
            ` (${currentTense})</h3><p style="color:#154a7e;">Tapez les formes correctes pour chaque pronom ci-dessous, puis vérifiez vos réponses.</p>`;
    }

    function randomizeTense() {
        if (useRandomTense) {
            const idx = Math.floor(Math.random() * tenses.length);
            currentTense = tenses[idx];
        }
        updateDescription();
        resetForm();
        clearScore();
    }

    function checkAnswers() {
        const form = document.getElementById('practiceForm');
        let correctCount = 0;
        let total = subjects.length * (usePronominal ? 2 : 1);
        let userAnswers = {};
        let resultRows = [];

        for (const sub of subjects) {
            const vInput = form.elements['savoir-' + sub];
            let svInput = null;
            if (usePronominal) {
                svInput = form.elements['sesavoir-' + sub];
            }

            const v = vInput.value.trim().toLowerCase();
            const sv = usePronominal ? svInput.value.trim().toLowerCase() : null;

            const vExpected = conjugationDb[currentTense][sub][0];
            const svExpected = usePronominal ? conjugationDb[currentTense][sub][1] : null;

            const vCorrect = v === vExpected;
            const svCorrect = usePronominal ? sv === svExpected : true;

            userAnswers[sub] = [v, sv, vCorrect, svCorrect];

            vInput.className = vCorrect ? 'correct' : 'incorrect';
            if (usePronominal) {
                svInput.className = svCorrect ? 'correct' : 'incorrect';
            }

            if (vCorrect) correctCount++;
            if (usePronominal && svCorrect) correctCount++;

            resultRows.push(
                `<li><b>${sub}</b> – <span style="color:#0f2d66;">[translate:savoir]:</span> <i>${v}</i> (${vCorrect ? '✔' : '✗'}, attendu <strong>${vExpected}</strong>)` +
                (usePronominal
                    ? ` <span style="margin-left:20px; color:#0f2d66;">[translate:se savoir]:</span> <i>${sv}</i> (${svCorrect ? '✔' : '✗'}, attendu <strong>${svExpected}</strong>)</li>`
                    : `</li>`)
            );
        }

        document.getElementById('scoreBlock').innerHTML =
            `Score pour <strong>${currentTense}</strong> : ${correctCount}/${total}`;

        prevAnswers.unshift({
            tense: currentTense,
            score: `${correctCount}/${total}`,
            detail: resultRows.join('')
        });

        showPrevious();
    }

    function showPrevious() {
        const prevBlock = document.getElementById('prevAnswersBlock');
        const prevList = document.getElementById('prevAnswersList');
        prevList.innerHTML = prevAnswers.map(
            (a) => `<li><b>${a.tense}</b> : <span style="color:#154a7e;">${a.score}</span><ul>${a.detail}</ul></li>`
        ).join('');
        prevBlock.style.display = prevAnswers.length ? 'block' : 'none';
    }

    function nextRound() {
        randomizeTense();
        clearScore();
    }

    function resetForm() {
        const form = document.getElementById('practiceForm');
        subjects.forEach((sub) => {
            const vInput = form.elements['savoir-' + sub];
            const svInput = form.elements['sesavoir-' + sub];
            if (vInput) {
                vInput.value = '';
                vInput.className = '';
            }
            if (svInput) {
                svInput.value = '';
                svInput.className = '';
            }
        });
        clearScore();
    }

    function clearScore() {
        document.getElementById('scoreBlock').innerHTML = '';
    }

    // Initialize interface
    randomizeTense();
</script>
</body>
</html>

